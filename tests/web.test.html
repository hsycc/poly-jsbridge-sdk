<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="./web.test.css" />
  
    <script src="../easyJsbridgeSdk.js"></script>

    <script src="../dist/browser/easyJsbridgeSdk.js"></script>
    <script>
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null
          ? ''
          : decodeURIComponent(results[1].replace(/\+/g, ' '));
      }

      const EXECUTING = 'Executing Test',
        SUCCESS = 'Success',
        FAILED = 'Failed';

      const waitOneSecond = () =>
        new Promise((resolve) => setTimeout(resolve, 1000));

      let mode = getUrlParameter('mode') || 'channel';

      let easyJsbridgeSdk;

      if (mode === 'url') {
        easyJsbridgeSdk = new EasyJsbridgeSdk.default({
          mode: 'url',
          maxTryTimes: 3,
          isDebug: true,
          protocol: 'flutter://',
          JavascriptChannelName: '',
        });
      } else {
        easyJsbridgeSdk = new EasyJsbridgeSdk.default({
          mode: 'channel',
          maxTryTimes: 3,
          isDebug: true,
          protocol: '',
          JavascriptChannelName: 'AppSdk',
        });
      }

      const runAllTests = async () => {
        const buttons = document.getElementsByTagName('button');
        for (var i = 1; i < buttons.length; i++) {
          var button = buttons[i];
          button.click();
          await waitOneSecond();
        }
        return;
      };

      const testToast = async (e) => {
        resultsLabel = e.target;
        resultsLabel.innerText = EXECUTING;
        try {
          const response = await easyJsbridgeSdk.toast('say hello', true);
          if (response.code == 200) {
            resultsLabel.className = 'success';
            resultsLabel.innerText = SUCCESS;
            return true;
          } else {
            resultsLabel.className = 'failed';
            resultsLabel.innerText = FAILED;
            console.error('easyJsbridgeSdk toast Failure: ', response.message);
            return false;
          }
        } catch (error) {
          resultsLabel.className = 'failed';
          resultsLabel.innerText = FAILED;
          console.error('easyJsbridgeSdk toast Failure: ', error);
          return false;
        }
      };
    </script>
  </head>

  <body>
    <div class="header-container">
      <div class="header">
        <h1>Web Build Integration Tests</h1>
        <button onClick="runAllTests();">Run All Tests</button>
      </div>
    </div>
    <div class="tests">
      <div>
        <h2>easyJsBrigde toast</h2>
        <button onClick="testToast(event);">Test</button>
      </div>
    </div>
  </body>
</html>
